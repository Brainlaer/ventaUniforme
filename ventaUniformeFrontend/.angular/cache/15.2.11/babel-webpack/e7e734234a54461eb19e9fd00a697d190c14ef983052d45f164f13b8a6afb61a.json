{"ast":null,"code":"import _asyncToGenerator from \"/home/bsvanegas/Documents/Workspace/deporte/ventaUniformeFrontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Observable } from 'rxjs';\nlet CarritoComponent = class CarritoComponent {\n  constructor(carritoService, personaService, reservaService, router, cdRef) {\n    this.carritoService = carritoService;\n    this.personaService = personaService;\n    this.reservaService = reservaService;\n    this.router = router;\n    this.cdRef = cdRef;\n    this.hasDate = true;\n    this.hasVestimentas = true;\n    this.reservado = false;\n    this.vestimentaList = this.carritoService.getVestimentas();\n    this.costo$ = new Observable();\n  }\n  ngOnInit() {\n    this.costo$ = this.carritoService.getTotal();\n  }\n  removeVestimenta(vestimentaItem) {\n    this.carritoService.removeVestimenta(vestimentaItem);\n  }\n  reservar() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this.reservado = false;\n      _this.hasDate = true;\n      _this.hasVestimentas = true;\n      console.log(sessionStorage.getItem('token'));\n      let total;\n      yield _this.costo$.subscribe(totalGotten => total = totalGotten);\n      let persona;\n      let tallaDtoList = [];\n      yield _this.personaService.findByCorreo(String(sessionStorage.getItem('correoPersona'))).subscribe(personaGotten => {\n        persona = personaGotten.id;\n        console.log(persona);\n        if (persona != null) {\n          let reserva = {\n            idPersona: persona,\n            tallaDtoList: tallaDtoList,\n            total: total,\n            fechaEntrega: _this.fechaEntrega\n          };\n          _this.vestimentaList.forEach(item => {\n            item.vestimenta.talla.vestimentaId = item.vestimenta.id;\n            item.vestimenta.talla.unidades = item.vestimenta.unidadesVestimenta;\n            tallaDtoList.push(item.vestimenta.talla);\n          });\n          console.log(reserva);\n          if (!reserva?.fechaEntrega) {\n            _this.hasDate = false;\n          } else if (reserva?.tallaDtoList.length == 0) {\n            _this.hasVestimentas = false;\n          } else {\n            _this.reservaService.reservar(reserva).subscribe(response => {\n              _this.reservado = true;\n              _this.cdRef.detectChanges();\n              console.log(_this.reservado);\n            }, error => {\n              if (error.status == 403) {\n                sessionStorage.removeItem('token');\n                sessionStorage.removeItem('isLoggin');\n                _this.router.navigateByUrl('/inicio-session');\n              }\n              console.log(error);\n            });\n          }\n        }\n      });\n    })();\n  }\n};\nCarritoComponent = __decorate([Component({\n  selector: 'app-carrito',\n  templateUrl: './carrito.component.html',\n  styleUrls: ['./carrito.component.css']\n})], CarritoComponent);\nexport { CarritoComponent };","map":{"version":3,"mappings":";;AAAA,SAASA,SAAS,QAAgB,eAAe;AAEjD,SAASC,UAAU,QAAQ,MAAM;AAW1B,IAAMC,gBAAgB,GAAtB,MAAMA,gBAAgB;EAK3BC,YACUC,cAA6B,EAC7BC,cAA6B,EAC7BC,cAA6B,EAC7BC,MAAa,EACbC,KAAwB;IAJxB,mBAAc,GAAdJ,cAAc;IACd,mBAAc,GAAdC,cAAc;IACd,mBAAc,GAAdC,cAAc;IACd,WAAM,GAANC,MAAM;IACN,UAAK,GAALC,KAAK;IARf,YAAO,GAAS,IAAI;IACpB,mBAAc,GAAS,IAAI;IAC3B,cAAS,GAAS,KAAK;IAgBvB,mBAAc,GAAO,IAAI,CAACJ,cAAc,CAACK,cAAc,EAAE;IACzD,WAAM,GAAoB,IAAIR,UAAU,EAAE;EAR1C;EAEAS,QAAQ;IACN,IAAI,CAACC,MAAM,GAAG,IAAI,CAACP,cAAc,CAACQ,QAAQ,EAAE;EAC9C;EAMAC,gBAAgB,CAACC,cAAkB;IACjC,IAAI,CAACV,cAAc,CAACS,gBAAgB,CAACC,cAAc,CAAC;EACtD;EAEMC,QAAQ;IAAA;IAAA;MACZ,KAAI,CAACC,SAAS,GAAC,KAAK;MACpB,KAAI,CAACC,OAAO,GAAC,IAAI;MACjB,KAAI,CAACC,cAAc,GAAC,IAAI;MACxBC,OAAO,CAACC,GAAG,CAACC,cAAc,CAACC,OAAO,CAAC,OAAO,CAAC,CAAC;MAC5C,IAAIC,KAAS;MACb,MAAM,KAAI,CAACZ,MAAM,CAACa,SAAS,CAAEC,WAAkB,IAAIF,KAAK,GAACE,WAAY,CAAC;MACtE,IAAIC,OAAc;MAClB,IAAIC,YAAY,GAAO,EAAE;MACxB,MAAM,KAAI,CAACtB,cAAc,CAACuB,YAAY,CAACC,MAAM,CAACR,cAAc,CAACC,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC,CAACE,SAAS,CAC/FM,aAAiB,IAAG;QACnBJ,OAAO,GAACI,aAAa,CAACC,EAAE;QACxBZ,OAAO,CAACC,GAAG,CAACM,OAAO,CAAC;QACpB,IAAGA,OAAO,IAAE,IAAI,EAAC;UACf,IAAIM,OAAO,GAAK;YACdC,SAAS,EAACP,OAAO;YACjBC,YAAY,EAACA,YAAY;YACzBJ,KAAK,EAACA,KAAK;YACXW,YAAY,EAAC,KAAI,CAACA;WACnB;UAED,KAAI,CAACC,cAAc,CAACC,OAAO,CAAEC,IAAQ,IAAG;YACtCA,IAAI,CAACC,UAAU,CAACC,KAAK,CAACC,YAAY,GAACH,IAAI,CAACC,UAAU,CAACP,EAAE;YACrDM,IAAI,CAACC,UAAU,CAACC,KAAK,CAACE,QAAQ,GAACJ,IAAI,CAACC,UAAU,CAACI,kBAAkB;YACjEf,YAAY,CAACgB,IAAI,CAACN,IAAI,CAACC,UAAU,CAACC,KAAK,CAAC;UAC1C,CAAC,CAAC;UACFpB,OAAO,CAACC,GAAG,CAACY,OAAO,CAAC;UACpB,IAAG,CAACA,OAAO,EAAEE,YAAY,EAAC;YACxB,KAAI,CAACjB,OAAO,GAAC,KAAK;WACnB,MACI,IAAGe,OAAO,EAAEL,YAAY,CAACiB,MAAM,IAAE,CAAC,EAAC;YACtC,KAAI,CAAC1B,cAAc,GAAC,KAAK;WAC1B,MAAI;YACH,KAAI,CAACZ,cAAc,CAACS,QAAQ,CAACiB,OAAO,CAAC,CAACR,SAAS,CAC5CqB,QAAY,IAAG;cACd,KAAI,CAAC7B,SAAS,GAAC,IAAI;cACnB,KAAI,CAACR,KAAK,CAACsC,aAAa,EAAE;cAC1B3B,OAAO,CAACC,GAAG,CAAE,KAAI,CAACJ,SAAS,CAAC;YAC9B,CAAC,EAAE+B,KAAK,IAAG;cACT,IAAGA,KAAK,CAACC,MAAM,IAAE,GAAG,EAAC;gBACnB3B,cAAc,CAAC4B,UAAU,CAAC,OAAO,CAAC;gBAClC5B,cAAc,CAAC4B,UAAU,CAAC,UAAU,CAAC;gBACrC,KAAI,CAAC1C,MAAM,CAAC2C,aAAa,CAAC,iBAAiB,CAAC;;cAE9C/B,OAAO,CAACC,GAAG,CAAC2B,KAAK,CAAC;YACpB,CAAC,CACF;;;MAMP,CAAC,CACF;IAAA;EAEH;CAMD;AAxFY7C,gBAAgB,eAL5BF,SAAS,CAAC;EACTmD,QAAQ,EAAE,aAAa;EACvBC,WAAW,EAAE,0BAA0B;EACvCC,SAAS,EAAE,CAAC,yBAAyB;CACtC,CAAC,GACWnD,gBAAgB,CAwF5B;SAxFYA,gBAAgB","names":["Component","Observable","CarritoComponent","constructor","carritoService","personaService","reservaService","router","cdRef","getVestimentas","ngOnInit","costo$","getTotal","removeVestimenta","vestimentaItem","reservar","reservado","hasDate","hasVestimentas","console","log","sessionStorage","getItem","total","subscribe","totalGotten","persona","tallaDtoList","findByCorreo","String","personaGotten","id","reserva","idPersona","fechaEntrega","vestimentaList","forEach","item","vestimenta","talla","vestimentaId","unidades","unidadesVestimenta","push","length","response","detectChanges","error","status","removeItem","navigateByUrl","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["/home/bsvanegas/Documents/Workspace/deporte/ventaUniformeFrontend/src/app/pages/carrito/carrito.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { AuthService } from 'src/app/services/auth/auth.service';\nimport { CarritoService } from 'src/app/services/carrito/carrito.service';\nimport { PersonaService } from 'src/app/services/persona.service';\nimport { ReservaService } from 'src/app/services/reserva/reserva.service';\n\n@Component({\n  selector: 'app-carrito',\n  templateUrl: './carrito.component.html',\n  styleUrls: ['./carrito.component.css']\n})\nexport class CarritoComponent implements OnInit {\n\n  hasDate:boolean=true;\n  hasVestimentas:boolean=true;\n  reservado:boolean=false;\n  constructor(\n    private carritoService:CarritoService,\n    private personaService:PersonaService,\n    private reservaService:ReservaService,\n    private router:Router,\n    private cdRef: ChangeDetectorRef\n\n  ){\n  }\n\n  ngOnInit(): void {\n    this.costo$ = this.carritoService.getTotal();\n  }\n\n  fechaEntrega!:Date;\n  vestimentaList:any[]=this.carritoService.getVestimentas();\n  costo$:Observable<number>=new Observable();\n\n  removeVestimenta(vestimentaItem:any){\n    this.carritoService.removeVestimenta(vestimentaItem);\n  }\n\n  async reservar(){\n    this.reservado=false;\n    this.hasDate=true;\n    this.hasVestimentas=true;\n    console.log(sessionStorage.getItem('token'));\n    let total:any;\n    await this.costo$.subscribe((totalGotten:number)=>(total=totalGotten));\n    let persona:string;\n    let tallaDtoList:any[]=[];\n     await this.personaService.findByCorreo(String(sessionStorage.getItem('correoPersona'))).subscribe(\n      (personaGotten:any)=>{\n        persona=personaGotten.id;\n        console.log(persona);\n        if(persona!=null){\n          let reserva:any={\n            idPersona:persona,\n            tallaDtoList:tallaDtoList,\n            total:total,\n            fechaEntrega:this.fechaEntrega\n          }\n          \n          this.vestimentaList.forEach((item:any)=>{\n            item.vestimenta.talla.vestimentaId=item.vestimenta.id;\n            item.vestimenta.talla.unidades=item.vestimenta.unidadesVestimenta;\n            tallaDtoList.push(item.vestimenta.talla);\n          })\n          console.log(reserva);\n          if(!reserva?.fechaEntrega){\n            this.hasDate=false;\n          }\n          else if(reserva?.tallaDtoList.length==0){\n            this.hasVestimentas=false;\n          }else{\n            this.reservaService.reservar(reserva).subscribe(\n              (response:any)=>{\n                this.reservado=true;\n                this.cdRef.detectChanges();\n                console.log( this.reservado);\n              },(error)=>{\n                if(error.status==403){\n                  sessionStorage.removeItem('token');\n                  sessionStorage.removeItem('isLoggin');\n                  this.router.navigateByUrl('/inicio-session');\n                }\n                console.log(error);\n              }\n            );\n          }\n          \n\n        }\n\n      }\n    )\n    \n  }\n\n\n\n\n\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}